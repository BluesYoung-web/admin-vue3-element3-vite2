var e=(e,l,a)=>new Promise(((o,d)=>{var t=e=>{try{i(a.next(e))}catch(l){d(l)}},u=e=>{try{i(a.throw(e))}catch(l){d(l)}},i=e=>e.done?o(e.value):Promise.resolve(e.value).then(t,u);i((a=a.apply(e,l)).next())}));import{d as l,f as a,g as o,o as d,c as t,b as u,l as i,x as n,q as r,k as s,h as c,F as p,S as v}from"./vendor.01d1481d.js";import{j as _,k as m,l as h,m as b,n as f}from"./system.95e8d616.js";import{d as w}from"./index.40da5c4d.js";const V=r("添加角色"),y=r("信息编辑"),k=r("权限编辑"),g=r("删除"),C=r("禁用"),x=r("启用"),U={class:"h-720px overflow-auto"};var j=l({setup(l){const j={autoid:0,role_name:"",role_desc:"",parent_role_id:0,is_enable:1,role_access:""},F=a(w(j)),E=a([]),S=a([]),z=a(!1),D=a(!1),I=a(!1),M=()=>e(this,null,(function*(){const e=yield _();E.value=w(e)})),P=new Map,q=e=>{for(const l of e)P.set(l.autoid,l),l.part.length>0&&q(l.part)},L=l=>e(this,null,(function*(){const e=yield m(l.autoid);let a=yield e.nodeList;S.value=w(a),q(S.value),F.value=l,I.value=!0})),A=l=>{p.confirm("确认删除该角色？","提示",{type:"warning"}).then((()=>e(this,null,(function*(){yield h(l.autoid),v.success("删除成功！"),M()})))).catch((()=>null))},B=()=>{z.value=!1,D.value=!1,I.value=!1,F.value=w(j)},G=()=>e(this,null,(function*(){z.value?(yield b(F.value),v.success("角色添加成功！")):(yield f(F.value),v.success("角色修改成功！")),B(),M()})),H=e=>{if(0!==e.part.length&&e.part.forEach((l=>{l.is_checked=e.is_checked,H(l)})),e.is_checked)for(;e.parent_id;){const l=P.get(e.parent_id);if(!l)break;(e=l)&&(e.is_checked=1)}},J=(e,l)=>{0!==e.length&&e.forEach((e=>{e.is_checked&&l.add(e.autoid),J(e.part,l)}))},K=()=>{const e=new Set;J(S.value,e),F.value.role_access=[...e].join(","),G()};return M(),(e,l)=>{const a=o("el-button"),p=o("el-table-column"),v=o("el-switch"),_=o("el-table"),m=o("el-input"),h=o("el-form-item"),b=o("el-radio"),f=o("el-form"),j=o("young-dialog"),M=o("el-checkbox");return d(),t(c,null,[u("div",null,[u(a,{type:"primary",size:"small",plain:"",onClick:l[1]||(l[1]=e=>z.value=!0)},{default:i((()=>[V])),_:1})]),n(" 角色列表 "),u(_,{data:E.value,style:{width:"100%"},size:"medium",height:"700"},{default:i((()=>[u(p,{prop:"autoid",label:"ID"}),u(p,{prop:"parent_role_id",label:"父角色ID"}),u(p,{prop:"role_name",label:"角色名称"}),u(p,{prop:"role_desc",label:"角色描述"}),u(p,{label:"不启用/启用"},{default:i((e=>[u(v,{modelValue:e.row.is_enable,"onUpdate:modelValue":l=>e.row.is_enable=l,"active-value":1,"inactive-value":0,"active-color":"#409EFF","inactive-color":"#909399",disabled:""},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),u(p,{label:"操作",width:"300"},{default:i((e=>[u(a,{onClick:l=>{return a=e.row,F.value=w(a),void(D.value=!0);var a}},{default:i((()=>[y])),_:2},1032,["onClick"]),u(a,{onClick:l=>L(e.row),type:"primary",plain:""},{default:i((()=>[k])),_:2},1032,["onClick"]),1!=+e.row.autoid?(d(),t(a,{key:0,type:"danger",onClick:l=>A(e.row)},{default:i((()=>[g])),_:2},1032,["onClick"])):n("v-if",!0)])),_:1})])),_:1},8,["data"]),n(" 信息 添加 | 编辑 "),u(j,{width:"400px","is-add":z.value,"is-edit":D.value,onSure:G,onClear:B},{body:i((()=>[u(f,{model:F.value,"label-width":"100px"},{default:i((()=>[u(h,{label:"角色名称"},{default:i((()=>[u(m,{modelValue:F.value.role_name,"onUpdate:modelValue":l[2]||(l[2]=e=>F.value.role_name=e),class:"pr-5"},null,8,["modelValue"])])),_:1}),u(h,{label:"角色描述"},{default:i((()=>[u(m,{modelValue:F.value.role_desc,"onUpdate:modelValue":l[3]||(l[3]=e=>F.value.role_desc=e),class:"pr-5"},null,8,["modelValue"])])),_:1}),u(h,{label:"父级角色id"},{default:i((()=>[u(m,{modelValue:F.value.parent_role_id,"onUpdate:modelValue":l[4]||(l[4]=e=>F.value.parent_role_id=e),modelModifiers:{number:!0},disabled:D.value,class:"pr-5"},null,8,["modelValue","disabled"])])),_:1}),1!==F.value.autoid?(d(),t(h,{key:0,label:"禁用|启用"},{default:i((()=>[u(b,{modelValue:F.value.is_enable,"onUpdate:modelValue":l[5]||(l[5]=e=>F.value.is_enable=e),label:0},{default:i((()=>[C])),_:1},8,["modelValue"]),u(b,{modelValue:F.value.is_enable,"onUpdate:modelValue":l[6]||(l[6]=e=>F.value.is_enable=e),label:1},{default:i((()=>[x])),_:1},8,["modelValue"])])),_:1})):n("v-if",!0)])),_:1},8,["model"])])),_:1},8,["is-add","is-edit"]),n(" 权限编辑 "),u(j,{width:"60vw",top:"2vh","is-edit":I.value,onSure:K,onClear:B},{body:i((()=>[u("div",U,[u(_,{data:S.value,style:{width:"100%","margin-bottom":"20px"},"row-key":"autoid","default-expand-all":!1,size:"medium","tree-props":{children:"part",hasChildren:"hasChildren"}},{default:i((()=>[u(p,{prop:"node_name",label:"节点名称",width:"240"},{default:i((e=>[u(M,{modelValue:e.row.is_checked,"onUpdate:modelValue":l=>e.row.is_checked=l,"true-label":1,"false-label":0,onChange:l=>H(e.row)},{default:i((()=>[r(s(e.row.node_name),1)])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),u(p,{prop:"autoid",label:"ID"}),u(p,{prop:"parent_id",label:"父节点"}),u(p,{prop:"node_path",label:"路径"}),u(p,{prop:"node_desc",label:"节点描述"}),u(p,{prop:"is_show",label:"隐藏/显示"},{default:i((e=>[u(v,{modelValue:e.row.is_show,"onUpdate:modelValue":l=>e.row.is_show=l,"active-value":1,"inactive-value":0,"active-color":"#409EFF","inactive-color":"#909399",disabled:""},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),u(p,{prop:"node_type",label:"节点级别"})])),_:1},8,["data"])])])),_:1},8,["is-edit"])],64)}}});export default j;
